<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnLuyen.vn v·ªõi Gemini AI Assistant</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Settings Button -->
    <button id="settings-btn" class="settings-float-btn" title="C√†i ƒë·∫∑t">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24M22 12h-6m-6 0H1"/>
        </svg>
    </button>

    <!-- Performance Indicator -->
    <div id="performance-indicator" class="performance-indicator good" draggable="true">
        <span id="perf-text">Performance: Good</span>
        <button id="close-perf-indicator" class="perf-close-btn">&times;</button>
    </div>

    <div class="container">
        <!-- Webview hi·ªÉn th·ªã trang OnLuyen -->
        <div class="webview-container">
            <!-- Navigation Bar -->
            <div class="navigation-bar">
                <div id="perf-indicator-condensed" class="perf-indicator-condensed hidden" title="Hi·ªÉn th·ªã Performance">
                    <div class="perf-dot good"></div>
                </div>
                <div class="nav-controls">
                    <button id="back-btn" class="nav-btn" title="Quay l·∫°i" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button id="forward-btn" class="nav-btn" title="Ti·∫øn t·ªõi" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                    <button id="reload-btn" class="nav-btn" title="T·∫£i l·∫°i">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                        </svg>
                    </button>
                    <button id="home-btn" class="nav-btn" title="Trang ch·ªß">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                        </svg>
                    </button>
                </div>
                <div class="url-bar-container">
                    <input type="text" id="url-bar" class="url-bar" placeholder="Nh·∫≠p URL..." />
                    <button id="go-btn" class="nav-btn" title="ƒêi t·ªõi">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Overlay hi·ªÉn th·ªã v·ªã tr√≠ click -->
            <div id="click-overlay" class="click-overlay hidden"></div>
            
            <webview 
                id="onluyen-webview" 
                src="https://app.onluyen.vn/"
                partition="persist:onluyen"
                allowpopups
                webpreferences="webSecurity=no"
            ></webview>
        </div>

        <!-- Sidebar ƒëi·ªÅu khi·ªÉn -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ü§ñ AI Assistant Control Panel</h2>
                <button id="pop-out-btn" class="pop-out-btn" title="M·ªü trong c·ª≠a s·ªï m·ªõi">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </button>
            </div>
            
            <!-- API Key Input -->
            <div class="control-group">
                <label for="api-key">Gemini API Keys (m·ªôt key m·ªói d√≤ng):</label>
                <textarea 
                    id="api-key" 
                    placeholder="D√°n m·ªôt ho·∫∑c nhi·ªÅu API Key v√†o ƒë√¢y, m·ªói key tr√™n m·ªôt d√≤ng..."
                    rows="4"
                ></textarea>
                <small>
                    <a href="#" id="save-api-key" style="color: #27ae60;">üíæ L∆∞u Keys</a>
                    <span id="api-key-status" style="margin-left: 10px;"></span>
                    <button id="toggle-api-key-visibility-btn" class="key-toggle-btn" title="Hi·ªán/·∫®n Key">
                        <svg class="icon-eye" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        <svg class="icon-eye-off hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
                    </button>
                </small>
            </div>

            <!-- Model Selection -->
            <div class="control-group">
                <label for="ai-model">Ch·ªçn Model:</label>
                <select id="ai-model">
                    <optgroup label="Gemini 2.5 Series (M·ªõi nh·∫•t)">
                        <option value="gemini-2.5-flash" selected>‚ö° Gemini 2.5 Flash (Nhanh, hi·ªáu qu·∫£)</option>
                        <option value="gemini-2.5-flash-lite">üí® Gemini 2.5 Flash Lite (Si√™u nhanh)</option>
                        <option value="gemini-2.5-pro">üöÄ Gemini 2.5 Pro (M·∫°nh nh·∫•t)</option>
                    </optgroup>
                    <optgroup label="Gemini 2.0 Series">
                        <option value="gemini-2.0-flash-exp">üß™ Gemini 2.0 Flash Experimental</option>
                    </optgroup>
                    <optgroup label="Gemini 1.5 Series">
                        <option value="gemini-1.5-flash">‚ö° Gemini 1.5 Flash</option>
                        <option value="gemini-1.5-pro">üíé Gemini 1.5 Pro</option>
                    </optgroup>
                </select>
                <small style="color: #666;">
                    üí° Khuy·∫øn ngh·ªã: 2.5 Flash cho c√¢n b·∫±ng t·ªëc ƒë·ªô v√† ch·∫•t l∆∞·ª£ng
                </small>
            </div>

            <!-- Anti-Tracking Toggle -->
            <div class="control-group">
                <label for="anti-tracking-toggle">
                    <span style="display: inline-flex; align-items: center; gap: 8px;">
                        üõ°Ô∏è Ch·∫ø ƒë·ªô Kh√¥ng Theo D√µi
                        <span class="badge badge-info" style="font-size: 10px;">BETA</span>
                    </span>
                </label>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label class="switch">
                        <input type="checkbox" id="anti-tracking-toggle">
                        <span class="slider"></span>
                    </label>
                    <select id="activity-level" style="flex: 1; padding: 5px;">
                        <option value="low">Ho·∫°t ƒë·ªông th·∫•p</option>
                        <option value="normal" selected>Ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</option>
                        <option value="high">Ho·∫°t ƒë·ªông cao</option>
                    </select>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    ‚ö° Gi·∫£ l·∫≠p ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng, ch·ªëng tracking, bypass AFK detection
                </small>
            </div>

            <!-- Custom Prompt -->
            <div class="control-group">
                <label for="custom-prompt">L·ªùi nh·∫Øn cho AI (t√πy ch·ªçn):</label>
                <textarea 
                    id="custom-prompt" 
                    placeholder="V√≠ d·ª•:&#10;- Gi·∫£i chi ti·∫øt c√¢u h·ªèi n√†y&#10;- Ch·ªçn ƒë√°p √°n ƒë√∫ng v√† gi·∫£i th√≠ch&#10;- L√†m t·∫•t c·∫£ c√°c c√¢u trong trang&#10;- N·ªôp b√†i sau khi ho√†n th√†nh"
                    rows="4"
                ></textarea>
                <small style="color: #666;">
                    üí° AI s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† gi·∫£i b√†i t·∫≠p
                </small>
            </div>

            <!-- Mode Selection -->
            <div class="mode-selection">
                <label>Ch·∫ø ƒë·ªô AI:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="ai-mode" value="analyze" checked>
                        <span>üìä Ph√¢n t√≠ch</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="ai-mode" value="action">
                        <span>üéØ Th·ª±c hi·ªán h√†nh ƒë·ªông</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="ai-mode" value="auto">
                        <span>üîÑ T·ª± ƒë·ªông</span>
                    </label>
                </div>
            </div>

            <!-- N√∫t ch·ª•p v√† g·ª≠i -->
            <button id="capture-and-send-btn" class="btn btn-primary">
                üì∏ Ch·ª•p v√† G·ª≠i AI
            </button>

            <!-- Hi·ªÉn th·ªã ·∫£nh ƒë√£ ch·ª•p -->
            <div class="screenshot-preview">
                <h3>üì∑ ·∫¢nh ƒê√£ Ch·ª•p:</h3>
                <div id="screenshot-container">
                    <p class="placeholder">Ch∆∞a c√≥ ·∫£nh n√†o</p>
                </div>
            </div>

            <!-- Action Controls -->
            <div id="action-controls" class="action-controls hidden">
                <h3>üéÆ ƒêi·ªÅu khi·ªÉn h√†nh ƒë·ªông:</h3>
                <div class="action-buttons">
                    <button id="execute-all-btn" class="btn btn-action">
                        ‚ñ∂Ô∏è Th·ª±c hi·ªán t·∫•t c·∫£
                    </button>
                    <button id="execute-step-btn" class="btn btn-action">
                        ‚è≠Ô∏è Th·ª±c hi·ªán t·ª´ng b∆∞·ªõc
                    </button>
                    <button id="stop-btn" class="btn btn-danger">
                        ‚èπÔ∏è D·ª´ng
                    </button>
                </div>
                
                <!-- Actions Queue -->
                <div id="actions-queue" class="actions-queue">
                    <h4>üìã Danh s√°ch h√†nh ƒë·ªông:</h4>
                    <div id="actions-list" class="actions-list">
                        <p class="placeholder">Ch∆∞a c√≥ h√†nh ƒë·ªông n√†o</p>
                    </div>
                </div>
            </div>

            <!-- Loading indicator -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <span>ƒêang x·ª≠ l√Ω...</span>
            </div>

            <!-- Hi·ªÉn th·ªã k·∫øt qu·∫£ t·ª´ Gemini -->
            <div class="result-container">
                <h3>üí° K·∫øt Qu·∫£ AI:</h3>
                <div id="gemini-result">
                    <p class="placeholder">Ch∆∞a c√≥ k·∫øt qu·∫£</p>
                </div>
            </div>

            <!-- Knowledge Base Section -->
            <hr style="margin-top: 20px; margin-bottom: 20px; border: 0; border-top: 1px solid #eee;">
            <div class="knowledge-base-section">
                <h2>üìö Knowledge Base & RAG</h2>
                
                <div class="control-group">
                    <label for="kb-question">Question:</label>
                    <textarea id="kb-question" rows="2" placeholder="Enter question for knowledge base"></textarea>
                </div>
                <div class="control-group">
                    <label for="kb-answer">Answer:</label>
                    <textarea id="kb-answer" rows="4" placeholder="Enter answer for knowledge base"></textarea>
                </div>
                <button id="save-knowledge-btn" class="btn btn-primary" style="margin-bottom: 20px;">üíæ Save Knowledge</button>
        
                <hr style="margin-top: 20px; margin-bottom: 20px; border: 0; border-top: 1px dashed #ccc;">
        
                <h3>Ask RAG:</h3>
                <div class="control-group">
                    <label for="rag-query-input">Your Query:</label>
                    <textarea id="rag-query-input" rows="2" placeholder="Ask a question to the RAG system"></textarea>
                </div>
                <button id="rag-query-btn" class="btn btn-success" style="margin-bottom: 20px;">‚ùì Ask RAG</button>
        
                <h3>RAG Response:</h3>
                <div id="rag-response">
                    <p class="placeholder">RAG response will appear here.</p>
                </div>
            </div>

            <!-- Footer info -->
            <div class="footer-info">
                <p>üí° <strong>H∆∞·ªõng d·∫´n:</strong></p>
                <ol>
                    <li>Nh·∫≠p API Key Gemini</li>
                    <li>Ch·ªçn ch·∫ø ƒë·ªô AI</li>
                    <li>Ch·ª•p m√†n h√¨nh trang web</li>
                    <li>G·ª≠i t·ªõi Gemini AI</li>
                    <li>AI s·∫Ω ph√¢n t√≠ch v√† th·ª±c hi·ªán</li>
                </ol>
                <p style="margin-top: 10px;">
                    <strong>Ph√≠m t·∫Øt:</strong><br>
                    ‚Ä¢ Ctrl+S: Ch·ª•p m√†n h√¨nh<br>
                    ‚Ä¢ Ctrl+Enter: G·ª≠i AI<br>
                    ‚Ä¢ Ctrl+A: Toggle Auto Mode<br>
                    ‚Ä¢ F12: Dev Console
                </p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è C√†i ƒê·∫∑t Performance</h2>
                <button class="modal-close" id="close-settings">‚úï</button>
            </div>
            
            <div class="modal-body">
                <!-- Performance Settings Section -->
                <div class="settings-section">
                    <h3>üöÄ T·ªëi ∆Øu Hi·ªáu NƒÉng</h3>
                    
                    <!-- Screenshot Quality -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="screenshot-quality">üì∏ Screenshot Quality</label>
                            <small>Gi·∫£m ch·∫•t l∆∞·ª£ng ·∫£nh ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô</small>
                        </div>
                        <div class="setting-control">
                            <input type="range" id="screenshot-quality" min="30" max="100" value="70" step="10">
                            <span id="quality-value">70%</span>
                        </div>
                    </div>

                    <!-- Dev Console -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="auto-dev-console">üîß Auto Open Dev Console</label>
                            <small>T·∫Øt ƒë·ªÉ gi·∫£m RAM usage khi kh·ªüi ƒë·ªông</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="auto-dev-console" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- DOM Snapshot Limit -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="dom-limit">üìÑ DOM Snapshot Limit</label>
                            <small>Gi·∫£m s·ªë elements ƒë·ªÉ ph√¢n t√≠ch nhanh h∆°n</small>
                        </div>
                        <div class="setting-control">
                            <input type="range" id="dom-limit" min="20" max="200" value="100" step="20">
                            <span id="dom-value">100</span>
                        </div>
                    </div>

                    <!-- Lazy Load -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="lazy-load">‚ö° Lazy Load Components</label>
                            <small>Ch·ªâ load components khi c·∫ßn thi·∫øt</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="lazy-load" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Animation -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="reduce-animation">üé® Reduce Animations</label>
                            <small>T·∫Øt animation ƒë·ªÉ tƒÉng FPS</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="reduce-animation">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Disable Notifications -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="disable-notifications">üîï Disable Notifications</label>
                            <small>T·∫Øt t·∫•t c·∫£ th√¥ng b√°o pop-up</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="disable-notifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Auto Mode Delay -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="auto-delay">‚è±Ô∏è Auto Mode Delay (ms)</label>
                            <small>Th·ªùi gian ch·ªù gi·ªØa c√°c action</small>
                        </div>
                        <div class="setting-control">
                            <input type="range" id="auto-delay" min="100" max="2000" value="500" step="100">
                            <span id="delay-value">500ms</span>
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div class="settings-section">
                    <h3>üî¨ C√†i ƒê·∫∑t N√¢ng Cao</h3>
                    
                    <!-- Cache -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="enable-cache">üíæ Enable Response Cache</label>
                            <small>Cache API responses ƒë·ªÉ gi·∫£m requests</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="enable-cache" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Debug Mode -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="debug-mode">üêõ Debug Mode</label>
                            <small>Hi·ªÉn th·ªã logs chi ti·∫øt</small>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" id="debug-mode">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Output Language -->
                    <div class="setting-item">
                        <div class="setting-info">
                            <label for="output-language">üåê Output Language</label>
                            <small>Ng√¥n ng·ªØ cho c√¢u tr·∫£ l·ªùi c·ªßa AI</small>
                        </div>
                        <div class="setting-control">
                            <input type="text" id="output-language" value="Ti·∫øng Vi·ªát">
                        </div>
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="settings-section">
                    <h3>üìä Performance Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-label">RAM Usage</span>
                            <span class="stat-value" id="ram-usage">0 MB</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">FPS</span>
                            <span class="stat-value" id="fps-counter">60</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Actions/Min</span>
                            <span class="stat-value" id="actions-per-min">0</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Cache Size</span>
                            <span class="stat-value" id="cache-size">0 KB</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="reset-settings">üîÑ Reset to Default</button>
                <button class="btn btn-primary" id="save-settings">üíæ Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Anti-tracking styles -->
    <style>
        /* Anti-tracking controls styling */
        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        #activity-level {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #333;
            min-width: 150px;
        }

        #activity-level option {
            background: white;
            color: #333;
        }
    </style>

    <script src="renderer.js"></script>
</body>
</html>